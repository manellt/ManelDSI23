<div class="stress-check-container">
  <mat-card class="stress-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon></mat-icon>
        Test de Stress
      </mat-card-title>
      <mat-card-subtitle>Évaluez votre niveau de stress actuel</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>

      <!-- Section pour changer les noms des critères -->
      <div class="names-section">
        <h4>Personnalisez les noms de vos critères</h4>
        <form [formGroup]="criteriaNames" class="names-form">
          <div class="name-inputs">
            <mat-form-field appearance="outline" class="name-field">
              <mat-label>Critère 1</mat-label>
              <input matInput formControlName="moodName">
            </mat-form-field>

            <mat-form-field appearance="outline" class="name-field">
              <mat-label>Critère 2</mat-label>
              <input matInput formControlName="sleepName">
            </mat-form-field>

            <mat-form-field appearance="outline" class="name-field">
              <mat-label>Critère 3</mat-label>
              <input matInput formControlName="activityName">
            </mat-form-field>
          </div>
        </form>
      </div>

      <form [formGroup]="stressForm" (ngSubmit)="onSubmit()">

        <!-- Mood input numérique -->
        <div class="input-section">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ criteriaNames.get('moodName')?.value }} (1-10)</mat-label>
            <input matInput type="number" formControlName="mood" min="1" max="10">
          </mat-form-field>
          <div class="advice-text">{{ moodAdvice }}</div>
        </div>

        <!-- Sleep input numérique -->
        <div class="input-section">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ criteriaNames.get('sleepName')?.value }} (0-12 heures)</mat-label>
            <input matInput type="number" formControlName="sleep" min="0" max="12" step="0.5">
          </mat-form-field>
          <div class="advice-text">{{ sleepAdvice }}</div>
        </div>

        <!-- Activity input numérique -->
        <div class="input-section">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ criteriaNames.get('activityName')?.value }} (1-10)</mat-label>
            <input matInput type="number" formControlName="activity" min="1" max="10">
          </mat-form-field>
          <div class="advice-text">{{ activityAdvice }}</div>
        </div>

        <!-- Notes -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Notes supplémentaires (optionnel)</mat-label>
          <textarea matInput formControlName="notes" rows="3"></textarea>
        </mat-form-field>

        <!-- Résultat instantané -->
        <div class="stress-preview" *ngIf="currentStressLevel >= 0">
          <h4>Niveau de stress estimé:
            <span class="stress-percentage">{{ currentStressLevel | number:'1.0-0' }}%</span>
          </h4>

          <mat-progress-bar
            mode="determinate"
            [value]="currentStressLevel"
            [color]="currentStressLevel < 30 ? 'primary' : currentStressLevel < 60 ? 'accent' : 'warn'">
          </mat-progress-bar>

          <div class="current-values">
            <div class="value-item">
              <span class="value-label">{{ criteriaNames.get('moodName')?.value }}</span>
              <span class="value-number">{{ mood?.value }}/10</span>
            </div>

            <div class="value-item">
              <span class="value-label">{{ criteriaNames.get('sleepName')?.value }}</span>
              <span class="value-number">{{ sleep?.value }}h</span>
            </div>

            <div class="value-item">
              <span class="value-label">{{ criteriaNames.get('activityName')?.value }}</span>
              <span class="value-number">{{ activity?.value }}/10</span>
            </div>
          </div>

          <div class="stress-advice">
            <pre>{{ currentAdvice }}</pre>
          </div>
        </div>

        <!-- Analyse button -->
        <div class="analysis-section" *ngIf="stressForm.valid">
          <button
            mat-raised-button
            class="analysis-btn"
            type="submit"
            [disabled]="isLoading">
            <mat-icon></mat-icon>
            {{ isLoading ? 'ANALYSE EN COURS...' : 'LANCER L\'ANALYSE' }}
          </button>
        </div>

        <div class="analysis-section" *ngIf="!stressForm.valid">
          <button mat-button disabled class="analysis-btn-disabled">
            <mat-icon>block</mat-icon>
            REMPLISSEZ TOUS LES CHAMPS
          </button>
        </div>

      </form>
    </mat-card-content>
  </mat-card>
</div>

